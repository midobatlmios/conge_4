import{r as c,j as e,S as _,a as A,L as z}from"./app-Ce2YBpep.js";import{c as U,B as j}from"./createLucideIcon-n0k5XbGK.js";import{u as K,g as H,a as B,b as G,c as X,f as E}from"./index-D3rSU_rS.js";import{D as V,a as I,b as $,c as J,d as Q,e as S,f as W,g as R,h as D,i as k,j as F,k as q,A as Y}from"./app-layout-Df8PrIGE.js";import{I as w}from"./input-CLdAzZZD.js";import{T as Z,a as ee,b as M,c as se,d as ae,e as T,S as te,f as re,g as le,h as ne,i as L}from"./select-WDzcoPeP.js";import{C as O}from"./checkbox-CJqiaP_X.js";import{L as N}from"./label-C2rIqixk.js";import"./check-464ca9Dm.js";import"./index-I4XksjuF.js";import"./index-CvAtKPGS.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],ie=U("Ellipsis",oe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ce=U("Plus",de);function me({columns:u,data:m}){var p,x;const[i,s]=c.useState([]),[a,o]=c.useState([]),[d,v]=c.useState({}),[h,r]=c.useState({}),t=K({data:m||[],columns:u,getCoreRowModel:X(),getPaginationRowModel:G(),onSortingChange:s,getSortedRowModel:B(),onColumnFiltersChange:o,getFilteredRowModel:H(),onColumnVisibilityChange:r,onRowSelectionChange:v,state:{sorting:i,columnFilters:a,columnVisibility:h,rowSelection:d}});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:[t.getFilteredSelectedRowModel().rows.length," of"," ",t.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center py-4",children:[e.jsx(w,{placeholder:"Filtrer par nom...",value:((p=t.getColumn("name"))==null?void 0:p.getFilterValue())??"",onChange:l=>{var n;return(n=t.getColumn("name"))==null?void 0:n.setFilterValue(l.target.value)},className:"max-w-sm"}),e.jsxs(V,{children:[e.jsx(I,{asChild:!0,children:e.jsx(j,{variant:"outline",className:"ml-auto",children:"Colonnes"})}),e.jsx($,{align:"end",children:t.getAllColumns().filter(l=>l.getCanHide()).map(l=>e.jsx(J,{className:"capitalize",checked:l.getIsVisible(),onCheckedChange:n=>l.toggleVisibility(!!n),children:l.id},l.id))})]})]}),e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:t.getHeaderGroups().map(l=>e.jsx(M,{children:l.headers.map(n=>e.jsx(se,{children:n.isPlaceholder?null:E(n.column.columnDef.header,n.getContext())},n.id))},l.id))}),e.jsx(ae,{children:(x=t.getRowModel().rows)!=null&&x.length?t.getRowModel().rows.map(l=>e.jsx(M,{"data-state":l.getIsSelected()&&"selected",children:l.getVisibleCells().map(n=>e.jsx(T,{children:E(n.column.columnDef.cell,n.getContext())},n.id))},l.id)):e.jsx(M,{children:e.jsx(T,{colSpan:u.length,className:"h-24 text-center",children:"Aucun résultat."})})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4 px-4",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>t.previousPage(),disabled:!t.getCanPreviousPage(),children:"Précédent"}),e.jsxs("span",{className:"mx-2",children:["Page ",t.getState().pagination.pageIndex+1," of"," ",t.getPageCount()]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>t.nextPage(),disabled:!t.getCanNextPage(),children:"Suivant"})]})]})]})}const ue=(u,m,i,s)=>[{id:"select",header:({table:a})=>e.jsx(O,{checked:a.getIsAllPageRowsSelected()||a.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:o=>a.toggleAllPageRowsSelected(!!o),"aria-label":"Select all"}),cell:({row:a})=>e.jsx(O,{checked:a.getIsSelected(),onCheckedChange:o=>a.toggleSelected(!!o),"aria-label":"Select row"})},{accessorKey:"name",header:"Nom"},{accessorKey:"email",header:"Email"},{accessorKey:"role",header:"Rôle",cell:({row:a})=>{const o=a.getValue("role");return e.jsx("div",{className:`font-medium ${o==="admin"?"text-blue-600":""}`,children:o==="admin"?"Administrateur":"Utilisateur"})}},{accessorKey:"email_verified_at",header:"Vérifié",cell:({row:a})=>{const o=a.getValue("email_verified_at");return e.jsx("div",{children:o?"Oui":"Non"})}},{accessorKey:"created_at",header:"Créé le",cell:({row:a})=>new Date(a.getValue("created_at")).toLocaleDateString("fr-FR")},{id:"actions",cell:({row:a})=>{const o=a.original;return e.jsxs(V,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Ouvrir le menu"}),e.jsx(ie,{className:"h-4 w-4"})]})}),e.jsxs($,{align:"end",children:[e.jsx(Q,{children:"Actions"}),e.jsx(S,{onClick:()=>navigator.clipboard.writeText(o.id.toString()),children:"Copier l'ID"}),e.jsx(S,{onClick:()=>{i(o),m(!0)},children:"Modifier l'utilisateur"}),e.jsx(S,{onClick:()=>s(o),className:"text-yellow-600",children:"Réinitialiser le mot de passe"}),e.jsx(W,{}),e.jsx(S,{className:"text-red-600",children:"Supprimer"})]})]})}}],pe=({isOpen:u,onClose:m,user:i})=>{const[s,a]=c.useState({id:0,name:"",email:"",email_verified_at:null,role:"user",created_at:"",updated_at:"",password:"",password_confirmation:""}),[o,d]=c.useState(null),[v,h]=c.useState(!1),[r,t]=c.useState({}),[p,x]=c.useState(!1);c.useEffect(()=>{i&&a({...i,password:"",password_confirmation:""})},[i]);const l=y=>{const{name:f,value:b}=y.target;a(C=>({...C,[f]:b})),r[f]&&t(C=>{const g={...C};return delete g[f],g})},n=async y=>{if(y.preventDefault(),h(!0),d(null),t({}),s.password&&s.password!==s.password_confirmation){t({password_confirmation:"Les mots de passe ne correspondent pas"}),h(!1);return}try{const f={_method:"PUT",name:s.name,email:s.email,role:s.role,password:s.password||void 0,password_confirmation:s.password_confirmation||void 0};_.post(`/admin/users/${i==null?void 0:i.id}`,f,{preserveScroll:!0,onSuccess:()=>{_.visit("/admin/users",{preserveState:!1,preserveScroll:!1})},onError:b=>{t(b),d({type:"error",text:"Une erreur s'est produite lors de la mise à jour de l'utilisateur"})}})}catch(f){console.error("Error updating user:",f),d({type:"error",text:"Une erreur s'est produite lors de la mise à jour de l'utilisateur"})}finally{h(!1)}};return e.jsx(R,{open:u,onOpenChange:m,children:e.jsxs(D,{"aria-describedby":"edit-user-description",children:[e.jsx(k,{children:e.jsx(F,{children:"Modifier l'utilisateur"})}),e.jsx("div",{id:"edit-user-description",className:"sr-only",children:"Formulaire de modification des informations de l'utilisateur"}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[o&&e.jsx("div",{className:`p-2 rounded ${o.type==="success"?"bg-green-200 text-green-800":"bg-red-200 text-red-800"}`,children:o.text}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{htmlFor:"name",children:"Nom"}),e.jsx(w,{id:"name",type:"text",name:"name",value:s.name,onChange:l,className:`w-full ${r.name?"border-red-500":""}`,required:!0}),r.name&&e.jsx("p",{className:"text-red-500 text-sm",children:r.name})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx(w,{id:"email",type:"email",name:"email",value:s.email,onChange:l,className:`w-full ${r.email?"border-red-500":""}`,required:!0}),r.email&&e.jsx("p",{className:"text-red-500 text-sm",children:r.email})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"font-medium",children:"Changer le mot de passe"}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{htmlFor:"password",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{id:"password",type:p?"text":"password",name:"password",value:s.password,onChange:l,className:`w-full ${r.password?"border-red-500":""}`,minLength:8}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2",onClick:()=>x(!p),children:p?"Masquer":"Afficher"})]}),r.password&&e.jsx("p",{className:"text-red-500 text-sm",children:r.password})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{htmlFor:"password_confirmation",children:"Confirmer le mot de passe"}),e.jsx(w,{id:"password_confirmation",type:p?"text":"password",name:"password_confirmation",value:s.password_confirmation,onChange:l,className:`w-full ${r.password_confirmation?"border-red-500":""}`,minLength:8}),r.password_confirmation&&e.jsx("p",{className:"text-red-500 text-sm",children:r.password_confirmation})]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{htmlFor:"role",children:"Rôle"}),e.jsxs("select",{id:"role",name:"role",value:s.role,onChange:l,className:`border p-2 rounded w-full ${r.role?"border-red-500":""}`,required:!0,children:[e.jsx("option",{value:"user",children:"Utilisateur"}),e.jsx("option",{value:"admin",children:"Administrateur"})]}),r.role&&e.jsx("p",{className:"text-red-500 text-sm",children:r.role})]}),e.jsxs(q,{children:[e.jsx(j,{variant:"outline",type:"button",onClick:m,disabled:v,children:"Annuler"}),e.jsx(j,{type:"submit",disabled:v,children:v?"Mise à jour...":"Modifier utilisateur"})]})]})]})})},he=({isOpen:u,onClose:m,user:i,onSuccess:s})=>{const[a,o]=c.useState(""),[d,v]=c.useState(""),[h,r]=c.useState(null),[t,p]=c.useState(!1),[x,l]=c.useState({}),[n,y]=c.useState(!1),f=async b=>{var C;if(b.preventDefault(),p(!0),r(null),l({}),a!==d){l({password_confirmation:["Les mots de passe ne correspondent pas"]}),p(!1);return}try{const g=((C=document.querySelector('meta[name="csrf-token"]'))==null?void 0:C.getAttribute("content"))||"",P=await A.put(`/users/${i==null?void 0:i.id}/reset-password`,{password:a,password_confirmation:d},{headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":g},withCredentials:!0});r({type:"success",text:"Mot de passe réinitialisé avec succès"}),setTimeout(()=>{m(),s()},1500)}catch(g){if(console.error("Error resetting password:",g),A.isAxiosError(g)&&g.response)if(g.response.status===422&&g.response.data.errors){l(g.response.data.errors);const P=Object.values(g.response.data.errors).flat().join(", ");r({type:"error",text:P})}else r({type:"error",text:g.response.data.message||"Une erreur s'est produite lors de la réinitialisation du mot de passe"});else r({type:"error",text:"Une erreur s'est produite lors de la réinitialisation du mot de passe"})}finally{p(!1)}};return e.jsx(R,{open:u,onOpenChange:m,children:e.jsxs(D,{children:[e.jsx(k,{children:e.jsxs(F,{children:["Réinitialiser le mot de passe de ",i==null?void 0:i.name]})}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[h&&e.jsx("div",{className:`p-2 rounded ${h.type==="success"?"bg-green-200 text-green-800":"bg-red-200 text-red-800"}`,children:h.text}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{htmlFor:"password",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{id:"password",type:n?"text":"password",value:a,onChange:b=>o(b.target.value),className:`w-full ${x.password?"border-red-500":""}`,minLength:8,required:!0}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2",onClick:()=>y(!n),children:n?"Masquer":"Afficher"})]}),x.password&&e.jsx("p",{className:"text-red-500 text-sm",children:x.password[0]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{htmlFor:"password_confirmation",children:"Confirmer le mot de passe"}),e.jsx(w,{id:"password_confirmation",type:n?"text":"password",value:d,onChange:b=>v(b.target.value),className:`w-full ${x.password_confirmation?"border-red-500":""}`,minLength:8,required:!0}),x.password_confirmation&&e.jsx("p",{className:"text-red-500 text-sm",children:x.password_confirmation[0]})]}),e.jsxs(q,{children:[e.jsx(j,{variant:"outline",type:"button",onClick:m,disabled:t,children:"Annuler"}),e.jsx(j,{type:"submit",disabled:t,children:t?"Réinitialisation...":"Réinitialiser le mot de passe"})]})]})]})})};function xe({isOpen:u,onClose:m,onSuccess:i}){const[s,a]=c.useState({name:"",email:"",password:"",role:"user"}),o=d=>{d.preventDefault(),_.post("/admin/users",s,{onSuccess:()=>{i()},preserveUrl:!0})};return e.jsx(R,{open:u,onOpenChange:m,children:e.jsxs(D,{className:"sm:max-w-[425px]",children:[e.jsx(k,{children:e.jsx(F,{children:"Ajouter un utilisateur"})}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nom"}),e.jsx(w,{id:"name",value:s.name,onChange:d=>a({...s,name:d.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"email",children:"Email"}),e.jsx(w,{id:"email",type:"email",value:s.email,onChange:d=>a({...s,email:d.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Mot de passe"}),e.jsx(w,{id:"password",type:"password",value:s.password,onChange:d=>a({...s,password:d.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"role",children:"Rôle"}),e.jsxs(te,{value:s.role,onValueChange:d=>a({...s,role:d}),children:[e.jsx(re,{children:e.jsx(le,{placeholder:"Sélectionner un rôle"})}),e.jsxs(ne,{children:[e.jsx(L,{value:"user",children:"Utilisateur"}),e.jsx(L,{value:"admin",children:"Administrateur"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:m,children:"Annuler"}),e.jsx(j,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Ajouter"})]})]})]})})}const ge=[{title:"Dashboard",href:"/dashboard"},{title:"Gestion des Utilisateurs",href:"/admin/users"}],Re=({users:u})=>{const[m,i]=c.useState([]),[s,a]=c.useState(!1),[o,d]=c.useState(!1),[v,h]=c.useState(!1),[r,t]=c.useState(null);c.useEffect(()=>{u&&i(u)},[u]);const p=()=>{u&&i(u)},x=n=>{i(y=>y.map(f=>f.id===n.id?n:f)),a(!1),t(null)},l=n=>{t(n),d(!0)};return m?e.jsxs(Y,{breadcrumbs:ge,children:[e.jsx(z,{title:"Gestion des Utilisateurs"}),e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Gestion des employés"}),e.jsxs(j,{onClick:()=>h(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Ajouter un employé"]})]}),e.jsx(me,{columns:ue(p,n=>a(n),t,l),data:m}),s&&r&&e.jsx(pe,{isOpen:s,onClose:()=>{a(!1),t(null)},user:r,onUpdate:x}),o&&r&&e.jsx(he,{isOpen:o,onClose:()=>{d(!1),t(null)},user:r,onSuccess:()=>{d(!1),t(null)}}),e.jsx(xe,{isOpen:v,onClose:()=>h(!1),onSuccess:()=>{h(!1),p()}})]})]}):e.jsx("div",{children:"Chargement..."})};export{Re as default};
